# 巨潮网年报下载器

这是一个从巨潮资讯网（cninfo.com.cn）批量下载A股和港股年报的Python脚本。

## 功能特性

- 🚀 **多种股票支持**: 支持A股主板、科创板、创业板和港股
- 📊 **智能识别**: 自动根据股票代码格式识别股票类型
- 📥 **批量下载**: 支持单个股票或批量股票文件
- 📅 **年份范围**: 支持单年份、年份范围或年份列表
- 🔍 **实时进度**: 显示下载进度和详细状态
- 📈 **详细汇总**: 提供完整的下载统计报告

## 支持的股票类型

| 股票类型 | 代码格式 | 示例 | 下载方式 |
|---------|---------|------|---------|
| A股主板 | 6位数字 (非688/300开头) | 000001, 600519 | API + requests |
| A股科创板 | 688开头6位数字 | 688001, 688009 | Selenium |
| A股创业板 | 300开头6位数字 | 300001, 300750 | Selenium |
| 港股 | 5位数字或HK前缀 | 00700, HK00939 | Selenium |

## 安装要求

### Python环境
- Python 3.7+

### 依赖包
```bash
pip install -r requirements.txt
```

### 浏览器要求（用于Selenium）
- Chrome浏览器
- ChromeDriver（需要与Chrome版本匹配）

**ChromeDriver安装:**
1. 查看Chrome版本：在Chrome地址栏输入 `chrome://version/`
2. 下载对应版本的ChromeDriver：https://chromedriver.chromium.org/
3. 将ChromeDriver添加到系统PATH中

## 使用方法

### 基本语法
```bash
python annual_report_downloader.py [-h] (-s STOCK | -f FILE) -y YEARS [-d DIR]
```

### 参数说明

| 参数 | 描述 | 必需 | 示例 |
|------|------|------|------|
| `-s, --stock` | 单个股票代码 | 与-f互斥 | `-s 000001` |
| `-f, --file` | 股票代码文件路径 | 与-s互斥 | `-f stocks.txt` |
| `-y, --years` | 年份范围 | 是 | `-y 2022` 或 `-y 2020-2022` |
| `-d, --dir` | 下载目录 | 否 | `-d ./downloads` |

### 年份格式支持

| 格式 | 说明 | 示例 | 结果 |
|------|------|------|------|
| 单年份 | 下载指定年份 | `2022` | [2022] |
| 年份范围 | 连续年份范围 | `2020-2022` | [2020, 2021, 2022] |
| 年份列表 | 指定多个年份 | `2020,2022,2023` | [2020, 2022, 2023] |

## 使用示例

### 1. 下载单个股票年报
```bash
# 下载平安银行2022年年报
python annual_report_downloader.py -s 000001 -y 2022

# 下载宁德时代2020-2022年年报
python annual_report_downloader.py -s 300750 -y 2020-2022

# 下载腾讯控股2021,2022年年报
python annual_report_downloader.py -s 00700 -y 2021,2022
```

### 2. 批量下载多个股票年报
```bash
# 使用股票列表文件
python annual_report_downloader.py -f sample_stocks.txt -y 2022

# 指定下载目录
python annual_report_downloader.py -f stocks.txt -y 2020-2022 -d ./my_reports
```

### 3. 股票代码文件格式
创建一个文本文件（如 `stocks.txt`），每行一个股票代码：
```
# A股主板
000001
600519

# A股科创板
688001

# A股创业板
300750

# 港股
00700
HK00939
```

## 输出说明

### 控制台输出
脚本运行时会显示详细的进度信息：
- 📊 股票类型识别
- 📥 年报查找状态
- ✓ 下载成功信息
- ✗ 错误和失败信息
- 📈 实时成功率统计

### 下载文件
- 默认保存在 `annual_reports/` 目录
- 文件名格式：`股票代码_年份年报.pdf`
- 示例：`000001_2022年报.pdf`

### 汇总报告
下载完成后显示详细统计：
- 总任务数、成功数、失败数
- 成功率百分比
- 按状态分组的详细统计
- 失败任务的错误详情

## 常见问题

### 1. ChromeDriver相关错误
**错误**: `selenium.common.exceptions.WebDriverException: 'chromedriver' executable needs to be in PATH`

**解决方案**: 
- 确保已安装Chrome浏览器
- 下载对应版本的ChromeDriver
- 将ChromeDriver添加到系统PATH中

### 2. 网络连接问题
**错误**: 请求超时或连接失败

**解决方案**:
- 检查网络连接
- 尝试使用VPN或代理
- 增加脚本中的超时时间

### 3. 找不到年报
**现象**: 显示"未找到年报"

**可能原因**:
- 该股票在指定年份未发布年报
- 网站结构发生变化
- 股票代码或年份有误

### 4. 下载速度慢
**解决方案**:
- 脚本内置了请求间隔以避免被封IP
- 建议在网络较好的环境下运行
- 可以分批次下载大量股票

## 技术实现

### A股主板
- 使用巨潮网公开API
- 通过HTTP请求获取公告列表
- 直接下载PDF文件

### A股科创板/创业板
- 使用Selenium自动化浏览器
- 自动获取orgId参数
- 模拟用户操作进行下载

### 港股
- 使用Selenium访问港股页面
- 通过搜索功能查找年报
- 自动触发下载操作

## 注意事项

1. **合规使用**: 本脚本仅用于学习和研究目的，请遵守巨潮网的使用条款
2. **频率控制**: 脚本内置了请求间隔，请勿修改以免被网站封禁
3. **数据准确性**: 下载的文件请以官方发布为准
4. **环境要求**: 确保Python环境和依赖包版本兼容

## 更新日志

### v1.0.0 (2024-01-01)
- 初始版本发布
- 支持A股主板、科创板、创业板和港股
- 实现批量下载和进度显示
- 添加详细的错误处理和汇总报告

## 许可证

MIT License

## 贡献

欢迎提交Issue和Pull Request来改进这个项目。