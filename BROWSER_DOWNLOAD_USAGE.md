# Annual Report Crawler - 浏览器下载版本

## 🎯 方案概述

这是一个**浏览器下载版本**，专门为了解决公司电脑上文件下载被加密的问题而设计。

### 核心思路
- **避免Python requests下载**: 所有文件下载都通过Selenium控制的浏览器完成
- **利用浏览器原生下载**: 使用Chrome浏览器的原生下载功能，绕过安全软件的文件加密
- **企业环境友好**: 专为公司电脑环境设计，兼容各种安全软件限制

## 🌐 浏览器下载版本特色

### ✅ 核心优势
- **避免文件加密**: 所有下载通过浏览器完成，文件不会被Python加密
- **企业环境友好**: 兼容绿盾等各种企业安全软件
- **完整功能保留**: 支持A股、港股、美股所有类型的年报下载
- **智能下载管理**: 自动等待下载完成，智能检测下载状态
- **原生浏览器体验**: 利用Chrome浏览器的原生下载功能

### 🔧 技术实现
- **Selenium WebDriver**: 控制Chrome浏览器进行自动化操作
- **智能下载检测**: 监控.crdownload临时文件，确保下载完成
- **多源数据支持**: 巨潮资讯网(A股/港股) + SEC EDGAR(美股)
- **浏览器配置优化**: 自动配置下载目录和下载选项

## 🚀 快速开始

### 一键启动
1. 双击运行 `start_browser_download.bat`
2. 等待5秒后浏览器会自动打开Web界面
3. 开始使用！

### 手动启动
```bash
python web_app_bd.py
```
然后在浏览器中访问 http://localhost:5000

## 📋 功能特性

### 🎨 Web界面特色
- **浏览器下载标识**: 明确标识这是浏览器下载版本
- **特色功能说明**: 详细说明浏览器下载的优势
- **实时进度显示**: 显示下载进度和当前处理的股票
- **智能日志输出**: 实时显示下载日志和状态信息
- **文件管理功能**: 列出已下载文件，支持直接下载

### 📊 支持的股票类型
- **A股主板**: 6位数字代码 (如: 000001, 600519)
- **A股科创板**: 688开头 (如: 688111, 688036)  
- **A股创业板**: 300开头 (如: 300750, 300122)
- **港股**: 5位数字代码 (如: 00700, 00939)
- **美股**: 字母代码 (如: AAPL, MSFT, GOOGL)

## 🛠️ 系统要求

### 必需依赖
- Python 3.7+
- Flask (Web框架)
- Selenium (浏览器自动化)
- WebDriver Manager (自动管理ChromeDriver)
- Chrome浏览器

### 自动安装
启动脚本会自动检查并安装缺失的依赖包。

## 🔍 使用说明

### 1. 股票代码输入
支持多种格式：
- 每行一个：
  ```
  000001
  600519
  AAPL
  ```
- 逗号分隔：`000001,600519,AAPL`

### 2. 年份设置
- 单个年份：`2023`
- 多个年份：`2022,2023`
- 年份范围：`2020-2023`

### 3. 下载目录
- 默认目录：`annual_reports`
- 可自定义目录路径

## 🌐 浏览器下载工作原理

### 1. 浏览器初始化
```python
# 配置Chrome下载选项
prefs = {
    "download.default_directory": download_path,
    "download.prompt_for_download": False,
    "plugins.always_open_pdf_externally": True,
}
chrome_options.add_experimental_option("prefs", prefs)
```

### 2. 智能下载检测
```python
def wait_for_download_complete(self, timeout=60):
    """等待下载完成"""
    while time.time() - start_time < timeout:
        # 检查.crdownload临时文件
        temp_files = list(self.download_dir.glob("*.crdownload"))
        if not temp_files:
            return True  # 下载完成
        time.sleep(1)
```

### 3. 多源数据处理
- **A股数据**: 通过JavaScript调用巨潮API
- **港股数据**: Selenium自动化搜索和下载
- **美股数据**: 访问SEC EDGAR网站下载10-K报告

## 📈 下载流程

### A股主板
1. 访问巨潮资讯网
2. 通过JavaScript调用API搜索年报
3. 构建下载URL
4. 浏览器自动下载PDF文件

### A股科创板/创业板
1. 获取股票orgId（通过JavaScript）
2. 搜索对应年份的年报公告
3. 提取下载链接
4. 浏览器下载PDF文件

### 港股
1. 访问巨潮港股页面
2. 输入股票代码搜索
3. 筛选年报类型公告
4. 浏览器下载PDF文件

### 美股
1. 访问SEC EDGAR搜索页面
2. 搜索指定股票的10-K报告
3. 找到HTML版本链接
4. 浏览器下载HTML文件

## 🔧 故障排除

### Chrome浏览器问题
1. 确保Chrome浏览器已安装
2. 检查ChromeDriver是否正常工作
3. 尝试手动更新ChromeDriver

### 下载目录问题
1. 确保下载目录有写入权限
2. 检查磁盘空间是否充足
3. 避免使用包含特殊字符的路径

### 网络连接问题
1. 检查网络连接是否正常
2. 确认可以访问巨潮资讯网和SEC网站
3. 检查公司防火墙设置

### 下载检测问题
1. 如果下载检测失败，检查下载目录
2. 手动清理.crdownload临时文件
3. 重启浏览器和应用程序

## 💡 优势对比

### vs 原版下载器
| 特性 | 原版 | 浏览器下载版 |
|------|------|-------------|
| 下载方式 | Python requests | 浏览器原生下载 |
| 文件加密 | ❌ 可能被加密 | ✅ 不会被加密 |
| 企业兼容性 | ⚠️ 可能受限 | ✅ 完全兼容 |
| 下载速度 | 快 | 中等 |
| 资源占用 | 低 | 中等（需要浏览器） |

### vs 云端部署
| 特性 | 云端部署 | 浏览器下载版 |
|------|----------|-------------|
| 部署成本 | ❌ 需要服务器 | ✅ 本地运行 |
| 数据安全 | ⚠️ 上传到云端 | ✅ 完全本地 |
| 网络依赖 | ❌ 高度依赖 | ✅ 仅下载时需要 |
| 文件传输 | ❌ 需要下载 | ✅ 直接本地 |

## 📝 开发说明

这个浏览器下载版本是原项目的一个**特殊改造版本**，核心改动：

### 主要变化
1. **下载方式**: `requests.get()` → `driver.get(url)`
2. **文件检测**: HTTP响应 → 文件系统监控
3. **配置管理**: 添加浏览器下载配置
4. **状态监控**: 增加下载完成检测逻辑

### 保持不变
- 股票类型识别逻辑
- 年报搜索和筛选逻辑  
- Web界面和用户体验
- 多源数据处理策略

这样的设计既解决了文件加密问题，又保持了原有功能的完整性。

## 🎉 使用建议

1. **首次使用**: 建议先测试1-2个股票，确认下载正常
2. **批量下载**: 大批量下载时建议分批进行，避免浏览器负载过重
3. **网络环境**: 确保网络稳定，避免下载中断
4. **磁盘空间**: 预留足够的磁盘空间存储年报文件
5. **定期清理**: 定期清理下载目录，避免文件过多

---

**Developed by Terence WANG** | 2025

🌐 **浏览器下载版本 - 专为企业环境设计，避免文件加密问题** 